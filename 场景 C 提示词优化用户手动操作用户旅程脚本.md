# 场景C:提示词优化 - AI辅助优化交互脚本

## 一、脚本概览

**场景目标:**用户通过选择Badcase或描述优化需求,AI自动诊断问题并生成优化后的提示词,完成基准测试、回归测试和版本对比

**预期轮次:**6-7轮对话完成(模式选择1轮+问题诊断1轮+优化方案1轮+测试准备1轮+执行测试2轮+结果分析1轮)

**交互原则:**问题驱动 + 数据验证 + 自动化测试 + 明确的用户确认环节

**关键变更:**
- ✅ 中间区域在用户确认前保持空白
- ✅ 所有诊断和优化规划都在右侧AI助手完成
- ✅ 用户明确点击"开始优化测试"后才执行
- ✅ 测试过程实时显示进度和结果

---

## 二、完整交互脚本

### 【第1轮】优化模式选择与问题定位

#### 用户操作区域
**右侧AI助手 - 模式选择界面**

**页面初始状态:**
```
┌──────────────────────────────────────────────────┐
│ 🔧 提示词优化中心                                  │
│                                                    │
│ 当前项目: 重庆银行信用卡导航助手                   │
│ 当前提示词版本: v2.3                              │
│ 最近更新: 2025-01-15                              │
│ 当前通过率: 85.2% (⚠️ 低于目标90%)                │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📋 选择优化模式:                                   │
│                                                    │
│ [🐛 Badcase修复模式]                              │
│ • 适用场景: 发现具体问题案例需要修复              │
│ • 输入要求: 选择Badcase对话记录                   │
│ • 优化重点: 针对性修复,避免回归                   │
│                                                    │
│ [🔍 智能诊断模式]                                 │
│ • 适用场景: 系统性排查潜在问题                    │
│ • 输入要求: 选择诊断范围                          │
│ • 优化重点: 全面优化,提升整体表现                │
│                                                    │
│ [✏️ 需求优化模式]                                  │
│ • 适用场景: 新增功能或调整策略                    │
│ • 输入要求: 描述优化需求                          │
│ • 优化重点: 功能增强或策略调整                    │
│                                                    │
│ [请选择优化模式]                                   │
└──────────────────────────────────────────────────┘
```

**用户操作:**
用户点击【🐛 Badcase修复模式】

**AI响应(界面切换,0.5秒)**

```
┌──────────────────────────────────────────────────┐
│ 🐛 Badcase修复模式                                 │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📊 最近7天Badcase统计:                             │
│                                                    │
│ • 总数: 23个                                       │
│ • 高优先级: 8个 (⚠️ 影响核心业务)                 │
│ • 中优先级: 12个                                   │
│ • 低优先级: 3个                                    │
│                                                    │
│ 🔍 按问题类型分类:                                 │
│ • 业务歧义识别失败: 8个                           │
│ • 上下文理解错误: 5个                             │
│ • 意图匹配不准确: 6个                             │
│ • 输出格式错误: 4个                               │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📝 请选择需要修复的Badcase:                        │
│                                                    │
│ ☐ [高优] Badcase #0127 - 用户说"修改密码"         │
│   问题: AI未区分"修改信用卡密码"/"修改查询密码"    │
│   发生时间: 2025-01-14 10:23                      │
│   业务影响: 用户进入错误页面,体验差               │
│                                                    │
│ ☐ [高优] Badcase #0129 - 用户说"查积分"           │
│   问题: AI直接跳转而非列出积分服务子选项          │
│   发生时间: 2025-01-14 14:56                      │
│   业务影响: 跳过了用户可能需要的其他积分服务      │
│                                                    │
│ ☐ [高优] Badcase #0131 - 用户说"帮你"             │
│   问题: 语音识别错误AI应识别为"办理"但直接报错    │
│   发生时间: 2025-01-15 09:12                      │
│   业务影响: 未提供容错,用户体验差                 │
│                                                    │
│ ☐ [中优] Badcase #0133 - 用户说"我要转账还要查询" │
│   问题: AI未拦截多需求,直接处理第一个需求         │
│   发生时间: 2025-01-15 11:34                      │
│   业务影响: 用户第二个需求被忽略                  │
│                                                    │
│ [显示更多] [批量选择]                              │
│                                                    │
│ [确认选择] [返回模式选择]                          │
└──────────────────────────────────────────────────┘
```

**用户操作:**
勾选 Badcase #0127,点击【确认选择】

### 【第2轮】问题深度诊断与上下文分析

**AI响应(思考动画 3秒)**

```
┌──────────────────────────────────────────────────┐
│ 🔍 正在分析Badcase...                              │
│                                                    │
│ ✅ 对话记录加载完成                                │
│ ✅ 上下文信息提取完成                              │
│ ✅ 提示词执行日志分析完成                          │
│                                                    │
│ 🤖 正在进行根因分析...                            │
└──────────────────────────────────────────────────┘
```

**AI响应(诊断报告,打字机效果 2秒)**

```
┌──────────────────────────────────────────────────┐
│ 📋 问题诊断报告                                    │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 🎯 Badcase详情: #0127                              │
│                                                    │
│ 【对话上下文】(时间轴展示)                        │
│                                                    │
│ T1: 用户输入                                       │
│    "我要修改密码"                                  │
│                                                    │
│ T2: AI推理过程 (🔴 问题点)                        │
│    • 意图识别: 修改密码 [✓]                       │
│    • 业务匹配: VChangePassword [✓]                │
│    • 歧义检测: 未执行 [✗]                         │
│    • 上下文检查: 无历史记录 [✓]                   │
│                                                    │
│ T3: AI响应                                         │
│    {"message":"小渝收到,马上为您跳转办理修改密码   │
│     业务","action":"VChangePassword"}              │
│                                                    │
│ T4: 用户反馈                                       │
│    [点击"返回"] → 进入错误页面                    │
│                                                    │
│ T5: 工作人员标注                                   │
│    问题类型: 业务歧义识别失败                     │
│    正确行为: 应列出"修改信用卡密码"/"修改查询      │
│              密码"让用户选择                       │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 🔍 根因分析:                                       │
│                                                    │
│ 【核心问题】                                       │
│ 提示词第240-250行"业务歧义强制检测"规则未被       │
│ 有效执行                                           │
│                                                    │
│ 【具体原因】                                       │
│ 1. 规则位置问题 (70%影响)                         │
│    • 歧义检测规则放在Step1之后                    │
│    • "修改密码"在Step1第二步被直接匹配            │
│    • 歧义检测规则未被触发                         │
│                                                    │
│ 2. 匹配逻辑缺陷 (25%影响)                         │
│    • 完整业务名检测仅检查三级业务                 │
│    • "修改密码"有多个业务但未被识别为歧义         │
│    • business_info中存在:                         │
│      - 账户管理 > 修改密码 (VChangePassword)      │
│      - 信用卡业务 > 修改查询密码                  │
│        (VChangeInqPassword)                       │
│                                                    │
│ 3. 示例不足 (5%影响)                              │
│    • examples中缺少"修改密码"歧义案例            │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 🎯 影响范围分析:                                   │
│                                                    │
│ 直接影响: 3个类似业务                             │
│ • 修改密码                                        │
│ • 重置密码                                        │
│ • 密码管理                                        │
│                                                    │
│ 潜在风险: 8个可能受影响的业务场景                 │
│ • 所有包含相同关键词但属于不同分类的业务          │
│                                                    │
│ 严重程度: ⚠️ 高 (核心交互逻辑问题)                │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 💡 优化建议预览:                                   │
│                                                    │
│ 🔧 修复方案1: 调整规则执行顺序 (推荐)             │
│   • 优先级: P0                                     │
│   • 实施难度: ★★☆☆☆                              │
│   • 预期效果: 完全解决此类问题                    │
│   • 影响范围: 所有歧义业务场景                    │
│                                                    │
│ 🔧 修复方案2: 增强歧义词库                         │
│   • 优先级: P1                                     │
│   • 实施难度: ★★★☆☆                              │
│   • 预期效果: 提升识别覆盖率                      │
│   • 影响范围: 特定关键词场景                      │
│                                                    │
│ 🔧 修复方案3: 补充示例对话                         │
│   • 优先级: P2                                     │
│   • 实施难度: ★☆☆☆☆                              │
│   • 预期效果: 提升模型理解                        │
│   • 影响范围: 类似表达方式                        │
│                                                    │
│ [查看详细方案] [生成优化版本] [返回]              │
└──────────────────────────────────────────────────┘
```

**用户操作:**
点击【生成优化版本】

### 【第3轮】优化方案生成与版本对比

**AI响应(思考动画 2秒)**

```
┌──────────────────────────────────────────────────┐
│ 🛠️ 正在生成优化方案...                             │
│                                                    │
│ ✓ 分析修复策略                                    │
│ ✓ 定位需要修改的代码段                            │
│ ⏳ 生成优化后的提示词                             │
└──────────────────────────────────────────────────┘
```

**AI响应(优化方案展示,1秒延迟)**

```
┌──────────────────────────────────────────────────┐
│ ✅ 优化方案已生成                                  │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📊 优化内容摘要:                                   │
│                                                    │
│ 修改位置: 提示词第230-280行                       │
│ 修改类型: 逻辑重构 + 规则补充                     │
│ 修改行数: 新增15行,删除3行,修改8行                │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📝 具体修改内容:                                   │
│                                                    │
│ 【修改1: 调整规则执行顺序】                       │
│                                                    │
│ 🔴 修改前 (v2.3):                                  │
│ ┌────────────────────────────────────────────┐   │
│ │ Step1: 业务意图识别与处理                    │   │
│ │   • 第一步-跳转确认指令检测                  │   │
│ │   • 第二步-完整业务名检测 ← 问题点          │   │
│ │   • 第三步-多需求拦截                        │   │
│ │   ...                                        │   │
│ │ 【上下文感知】                                │   │
│ │   3. 业务歧义强制检测 ← 位置太后            │   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ 🟢 修改后 (v2.4):                                  │
│ ┌────────────────────────────────────────────┐   │
│ │ 【上下文感知】                                │   │
│ │   3. 业务歧义强制检测 ← 提前到最前面        │   │
│ │      (在进行任何业务匹配前强制执行)         │   │
│ │                                              │   │
│ │ Step1: 业务意图识别与处理                    │   │
│ │   • 第一步-跳转确认指令检测                  │   │
│ │   • 第二步-完整业务名检测                    │   │
│ │   • 第三步-多需求拦截                        │   │
│ │   ...                                        │   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 【修改2: 增强歧义词库】                           │
│                                                    │
│ 🔴 修改前:                                         │
│ ┌────────────────────────────────────────────┐   │
│ │ **常见歧义业务示例(必须二次确认):**          │   │
│ │  - "修改密码" → 必须二次确认:"您是要修改     │   │
│ │     信用卡密码,还是修改信用卡查询密码？"     │   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ 🟢 修改后:                                         │
│ ┌────────────────────────────────────────────┐   │
│ │ **常见歧义业务示例(必须二次确认):**          │   │
│ │  - "修改密码" → 检测到2个匹配业务:          │   │
│ │     • 账户管理 > 修改密码 (VChangePassword)  │   │
│ │     • 信用卡业务 > 修改查询密码             │   │
│ │       (VChangeInqPassword)                   │   │
│ │     必须二次确认:"您是要修改信用卡密码,      │   │
│ │     还是修改信用卡查询密码？"                │   │
│ │                                              │   │
│ │  - "重置密码" → 检测到business_info中仅1个  │   │
│ │     匹配,默认理解为"重置查询密码",但需确认  │   │
│ │                                              │   │
│ │  - "密码" → 检测到3个相关业务,必须列举      │   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 【修改3: 补充示例对话】                           │
│                                                    │
│ 🟢 新增示例:                                       │
│ ┌────────────────────────────────────────────┐   │
│ │ <example>                                    │   │
│ │ <input>我要修改密码</input>                  │   │
│ │ <output>{"message":"小渝了解您需要修改密码   │   │
│ │ 。我们提供:修改信用卡密码、修改信用卡查询    │   │
│ │ 密码,请问您需要修改哪一种密码？",           │   │
│ │ "action":""}</output>                        │   │
│ │ </example>                                   │   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 💡 预期效果:                                       │
│                                                    │
│ ✓ 完全解决"修改密码"歧义问题                      │
│ ✓ 覆盖所有类似歧义场景                            │
│ ✓ 提升整体业务匹配准确率约5-8%                    │
│ ✓ 减少用户进入错误页面的情况                      │
│                                                    │
│ ⚠️ 潜在风险:                                       │
│                                                    │
│ • 可能导致部分原本快速跳转的场景多一次确认        │
│ • 需要回归测试验证其他业务不受影响                │
│                                                    │
│ [开始测试验证] [手动调整方案] [放弃优化]          │
└──────────────────────────────────────────────────┘
```

**用户操作:**
点击【开始测试验证】

### 【第4轮】测试准备与配置

**AI响应(测试配置界面,0.5秒)**

```
┌──────────────────────────────────────────────────┐
│ 🧪 测试准备                                        │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📋 1. 测试用例集选择                               │
│                                                    │
│ ☑ 自动包含:                                        │
│   • Badcase #0127 (问题案例本身)                  │
│   • 相关的8个类似场景用例                         │
│   • 密码相关业务的标准测试用例(15个)              │
│                                                    │
│ ☐ 可选添加:                                        │
│   ☐ 完整回归测试集(200个用例)                     │
│   ☐ 核心业务场景集(50个用例)                      │
│   ☐ 边缘场景测试集(30个用例)                      │
│                                                    │
│ 当前选择: 24个用例                                │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ ⚙️ 2. 测试参数配置                                 │
│                                                    │
│ 模型选择:                                         │
│ ◉ claude-sonnet-4-20250514 (推荐)                 │
│ ○ claude-opus-4-20250119                          │
│                                                    │
│ 温度参数:                                         │
│ ◉ 0.3 (推荐-稳定性优先)                          │
│ ○ 0.7 (创造性优先)                                │
│                                                    │
│ 测试策略:                                         │
│ ◉ 严格匹配 (action必须完全一致)                  │
│ ○ 语义匹配 (允许合理的等价跳转)                  │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📊 3. 测试流程预览                                 │
│                                                    │
│ 阶段1: 基准测试 (当前版本v2.3)                    │
│ • 预计耗时: 约2分钟                               │
│ • 建立性能基线                                    │
│                                                    │
│ 阶段2: 回归测试 (优化版本v2.4)                    │
│ • 预计耗时: 约2分钟                               │
│ • 验证优化效果                                    │
│                                                    │
│ 阶段3: 对比分析                                    │
│ • 通过率变化                                      │
│ • 修复情况统计                                    │
│ • 新增问题预警                                    │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ ⚠️ 重要提示:                                       │
│ 测试将在模拟环境中进行,不影响生产环境             │
│                                                    │
│ [确认开始测试] [调整配置]                          │
└──────────────────────────────────────────────────┘
```

**用户操作:**
点击【确认开始测试】

### 【第5轮】执行基准测试与回归测试(⭐关键环节)

⚠️ **此时中间区域仍保持空白,等待测试完成后填充**

#### 阶段1: 基准测试执行

**AI响应(右侧实时进度)**

```
┌──────────────────────────────────────────────────┐
│ 🧪 阶段1/3: 基准测试进行中...                      │
│                                                    │
│ 当前版本: v2.3 (优化前)                           │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━ 45%                 │
│                                                    │
│ 测试进度: 11/24 完成                              │
│                                                    │
│ 实时结果:                                         │
│ ✅ 通过: 7个                                       │
│ ❌ 失败: 4个                                       │
│ ⏳ 进行中: 测试用例#12                            │
│                                                    │
│ 最新失败案例:                                     │
│ ❌ 用例#07: "我要修改密码"                        │
│    预期: action应为空,需要二次确认                │
│    实际: action="VChangePassword" (错误跳转)      │
│                                                    │
│ 预计剩余时间: 1分15秒                             │
└──────────────────────────────────────────────────┘
```

**基准测试完成(2分钟后)**

```
┌──────────────────────────────────────────────────┐
│ ✅ 阶段1/3: 基准测试完成                           │
│                                                    │
│ 版本: v2.3 (优化前)                               │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100%                │
│                                                    │
│ 📊 测试结果:                                       │
│                                                    │
│ 总用例数: 24个                                    │
│ ✅ 通过: 16个 (66.7%)                             │
│ ❌ 失败: 8个 (33.3%)                              │
│                                                    │
│ 失败案例分类:                                     │
│ • 歧义识别失败: 5个 ← 核心问题                   │
│ • 上下文理解错误: 2个                             │
│ • 其他问题: 1个                                   │
│                                                    │
│ ⏱️ 总耗时: 1分58秒                                 │
│                                                    │
│ [查看详细报告] [继续回归测试]                      │
└──────────────────────────────────────────────────┘
```

**同时,中间区域开始填充基准测试结果:**

```
T+120s: 中间区域标题栏填充
        "提示词优化测试 - 基准测试结果(v2.3)"
        (蓝色高亮1秒)

T+121s: [测试概览] 卡片填充
        • 版本: v2.3
        • 测试时间: 2025-01-16 14:23:15
        • 通过率: 66.7%
        • 失败数: 8个
        (逐项填充,每项0.3秒,蓝色高亮)

T+123s: [失败用例列表] 开始填充
        逐条显示8个失败用例的详情
        (每条0.5秒,蓝色高亮)
```

#### 阶段2: 回归测试执行

**用户点击【继续回归测试】后**

**AI响应(右侧实时进度)**

```
┌──────────────────────────────────────────────────┐
│ 🧪 阶段2/3: 回归测试进行中...                      │
│                                                    │
│ 当前版本: v2.4 (优化后)                           │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━ 58%                 │
│                                                    │
│ 测试进度: 14/24 完成                              │
│                                                    │
│ 实时结果:                                         │
│ ✅ 通过: 13个 (↑ 相比基准+6)                      │
│ ❌ 失败: 1个 (↓ 相比基准-7)                       │
│ ⏳ 进行中: 测试用例#15                            │
│                                                    │
│ 🎉 关键改善:                                       │
│ ✅ 用例#07: "我要修改密码" → 已修复!             │
│    现在正确返回action="" + 二次确认              │
│                                                    │
│ 预计剩余时间: 55秒                                │
└──────────────────────────────────────────────────┘
```

**回归测试完成(4分钟后)**

```
┌──────────────────────────────────────────────────┐
│ ✅ 阶段2/3: 回归测试完成                           │
│                                                    │
│ 版本: v2.4 (优化后)                               │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100%                │
│                                                    │
│ 📊 测试结果:                                       │
│                                                    │
│ 总用例数: 24个                                    │
│ ✅ 通过: 22个 (91.7%)                             │
│ ❌ 失败: 2个 (8.3%)                               │
│                                                    │
│ 失败案例分类:                                     │
│ • 上下文理解错误: 2个 (未在本次修复范围)         │
│ • 歧义识别失败: 0个 ✅ 完全修复                   │
│                                                    │
│ ⏱️ 总耗时: 2分03秒                                 │
│                                                    │
│ [查看详细报告] [开始对比分析]                      │
└──────────────────────────────────────────────────┘
```

**中间区域继续填充回归测试结果:**

```
T+243s: 中间区域添加新版块
        "回归测试结果(v2.4)"
        (蓝色高亮1秒)

T+244s: [测试概览] 卡片填充
        • 版本: v2.4
        • 通过率: 91.7% (↑25%)
        • 失败数: 2个 (↓6个)
        (逐项填充,每项0.3秒,蓝色高亮)

T+246s: [修复情况] 列表填充
        显示8个原失败用例的修复状态
        (每条0.4秒,蓝色高亮)
```

### 【第6轮】对比分析与版本发布决策

**用户点击【开始对比分析】后**

**AI响应(生成对比报告,思考动画 2秒)**

```
┌──────────────────────────────────────────────────┐
│ 📊 正在生成对比分析报告...                         │
│                                                    │
│ ✓ 提取测试数据                                    │
│ ✓ 计算性能指标                                    │
│ ✓ 分析修复情况                                    │
│ ⏳ 检测回归问题                                    │
└──────────────────────────────────────────────────┘
```

**AI响应(完整对比报告,右侧显示)**

```
┌──────────────────────────────────────────────────┐
│ 📊 版本对比分析报告                                │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 🎯 整体表现对比                                    │
│                                                    │
│                    v2.3        v2.4      变化      │
│ ─────────────────────────────────────────────    │
│ 通过率          66.7%       91.7%     +25.0% ✅   │
│ 通过数          16/24       22/24     +6个 ✅     │
│ 失败数           8/24        2/24     -6个 ✅     │
│ 平均响应时间    1.2s        1.3s      +0.1s ⚠️    │
│ Token消耗       245         268       +23 ⚠️      │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 🎉 修复情况详情                                    │
│                                                    │
│ ✅ 成功修复 (6个):                                 │
│                                                    │
│ 1. 用例#07: "我要修改密码"                        │
│    • 问题: 直接跳转VChangePassword                │
│    • 修复后: action="" + 列出两种密码选项         │
│    • 状态: ✅ 完美修复                             │
│                                                    │
│ 2. 用例#11: "修改信用卡密码"                      │
│    • 问题: 触发歧义检测(不应该)                   │
│    • 修复后: 正确识别为完整业务名,直接跳转        │
│    • 状态: ✅ 完美修复                             │
│                                                    │
│ 3. 用例#13: "我想改个密码"                        │
│    • 问题: 直接跳转                               │
│    • 修复后: 正确触发歧义检测                     │
│    • 状态: ✅ 完美修复                             │
│                                                    │
│ 4. 用例#15: "密码忘了"                            │
│    • 问题: 跳转修改密码(应该是重置)               │
│    • 修复后: 列出修改/重置选项                    │
│    • 状态: ✅ 完美修复                             │
│                                                    │
│ 5. 用例#18: "重置密码"                            │
│    • 问题: 未确认就跳转                           │
│    • 修复后: 询问确认"您是要重置查询密码吗?"      │
│    • 状态: ✅ 完美修复                             │
│                                                    │
│ 6. 用例#21: "帮我搞一下密码"                      │
│    • 问题: 直接报错                               │
│    • 修复后: 理解为密码相关,列出选项              │
│    • 状态: ✅ 完美修复                             │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ ⚠️ 仍失败用例 (2个):                               │
│                                                    │
│ 1. 用例#04: "查一下我的积分还有查交易"            │
│    • 问题类型: 多需求拦截失败                     │
│    • 原因: 上下文复杂场景未覆盖                   │
│    • 优先级: P2 (不在本次修复范围)                │
│                                                    │
│ 2. 用例#19: "上次说的那个业务"                    │
│    • 问题类型: 上下文理解错误                     │
│    • 原因: 缺少长期记忆能力                       │
│    • 优先级: P3 (需要架构升级)                    │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 🔍 回归问题检测                                    │
│                                                    │
│ ✅ 无回归问题发现                                  │
│                                                    │
│ 所有原本通过的16个用例在新版本中仍然通过          │
│ 新版本未引入任何新的失败案例                      │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 💰 成本效益分析                                    │
│                                                    │
│ 响应时间增加: +0.1s (+8.3%)                       │
│ • 原因: 增加了歧义检测步骤                        │
│ • 影响: 可接受 (仍在1.5s以内)                    │
│                                                    │
│ Token消耗增加: +23 tokens (+9.4%)                 │
│ • 原因: 提示词长度增加                            │
│ • 影响: 可接受 (预算内)                          │
│                                                    │
│ 用户体验提升: 显著 ✅                              │
│ • 错误跳转减少75%                                 │
│ • 用户困惑场景减少                                │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 🎯 综合评估                                        │
│                                                    │
│ ✅ 目标达成情况:                                   │
│ • 通过率从66.7%提升到91.7% (目标90%)              │
│ • 核心问题完全修复                                │
│ • 无回归问题                                      │
│                                                    │
│ ⭐ 推荐决策: 建议发布到生产环境                   │
│                                                    │
│ 理由:                                             │
│ 1. 通过率大幅提升,超过目标                        │
│ 2. 核心歧义识别问题完全解决                       │
│ 3. 成本增加在可接受范围内                         │
│ 4. 无回归风险                                     │
│ 5. 显著提升用户体验                               │
│                                                    │
│ [保存新版本] [直接发布] [继续优化] [放弃]         │
└──────────────────────────────────────────────────┘
```

**同时,中间区域完成最终填充:**

```
T+250s: 中间区域添加最终版块
        "版本对比与发布决策"
        (蓝色高亮1秒)

T+251s: [提示词Diff对比] 区域展开
        左右分屏显示v2.3 vs v2.4代码差异
        • 删除的行: 红色高亮
        • 新增的行: 绿色高亮
        • 修改的行: 黄色高亮
        (逐行加载,0.1秒/行)

T+255s: [性能指标对比图表] 填充
        柱状图/折线图展示通过率变化
        (动画效果,1秒)

T+257s: [版本信息卡片] 填充
        • 版本号: v2.4
        • 创建时间: 2025-01-16 14:32:45
        • 优化类型: Bug修复
        • 修改行数: 新增15行,删除3行,修改8行
        (逐项填充,每项0.3秒)
```

### 【第7轮】版本保存与发布

**用户点击【直接发布】**

**AI响应(发布配置界面)**

```
┌──────────────────────────────────────────────────┐
│ 🚀 发布配置                                        │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📝 版本信息 (必填)                                 │
│                                                    │
│ 版本号: v2.4 [自动生成]                           │
│                                                    │
│ 版本名称: ___________________________             │
│ 建议: "修复密码业务歧义识别问题"                  │
│                                                    │
│ 版本类型:                                         │
│ ◉ Bug修复                                         │
│ ○ 性能优化                                        │
│ ○ 功能增强                                        │
│ ○ 安全修复                                        │
│                                                    │
│ 变更日志: (自动生成,可编辑)                       │
│ ┌────────────────────────────────────────────┐   │
│ │【核心修复】                                  │   │
│ │• 修复"修改密码"等歧义业务识别失败问题       │   │
│ │• 调整规则执行顺序,将歧义检测提前            │   │
│ │• 增强歧义业务词库覆盖                        │   │
│ │• 补充示例对话                                │   │
│ │                                              │   │
│ │【性能表现】                                  │   │
│ │• 通过率: 66.7% → 91.7% (+25%)               │   │
│ │• 修复用例: 6个                               │   │
│ │• 无回归问题                                  │   │
│ │                                              │   │
│ │【影响范围】                                  │   │
│ │• 所有密码相关业务场景                        │   │
│ │• 所有歧义业务场景                            │   │
│ └────────────────────────────────────────────┘   │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 🎯 发布策略                                        │
│                                                    │
│ ◉ 灰度发布 (推荐)                                 │
│    • 先发布到10%流量                              │
│    • 观察24小时                                   │
│    • 无问题后全量发布                             │
│                                                    │
│ ○ 直接全量发布                                    │
│    • 立即应用到100%流量                           │
│    • 适用于紧急修复                               │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📋 影响范围                                        │
│                                                    │
│ 关联意图: 5个                                     │
│ • 账户管理 - 修改密码                             │
│ • 信用卡业务 - 修改查询密码                       │
│ • 信用卡业务 - 重置查询密码                       │
│ • 所有存在歧义的业务场景                          │
│                                                    │
│ 预计影响用户: ~30% (使用密码相关功能的用户)       │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ ⚠️ 发布前确认清单:                                 │
│                                                    │
│ ☑ 测试通过率达标 (91.7% > 90%)                    │
│ ☑ 无回归问题                                      │
│ ☑ 核心问题已修复                                  │
│ ☑ 变更日志已填写                                  │
│ ☐ 团队成员已review                                │
│ ☐ 回滚方案已准备                                  │
│                                                    │
│ [确认发布] [保存草稿] [取消]                       │
└──────────────────────────────────────────────────┘
```

**用户填写版本名称,点击【确认发布】**

**AI响应(发布执行,思考动画)**

```
┌──────────────────────────────────────────────────┐
│ 🚀 正在发布版本v2.4...                             │
│                                                    │
│ ✓ 保存新版本提示词                                │
│ ✓ 更新版本记录                                    │
│ ✓ 生成Diff文件                                    │
│ ⏳ 推送到生产环境                                  │
│ ⏳ 配置灰度策略                                    │
└──────────────────────────────────────────────────┘
```

**发布完成(5秒后)**

```
┌──────────────────────────────────────────────────┐
│ 🎉 版本v2.4发布成功!                               │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ ✅ 发布详情:                                       │
│                                                    │
│ • 版本号: v2.4                                    │
│ • 版本名称: 修复密码业务歧义识别问题              │
│ • 发布时间: 2025-01-16 14:38:22                   │
│ • 发布策略: 灰度发布(10%流量)                     │
│ • 发布状态: ✅ 成功                                │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 📊 监控面板:                                       │
│                                                    │
│ 当前灰度流量: 10%                                 │
│ 预计影响用户: 约100人/小时                        │
│ 监控周期: 24小时                                  │
│ 自动全量时间: 2025-01-17 14:38                    │
│                                                    │
│ [查看实时监控] [手动扩大流量] [紧急回滚]          │
│                                                    │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    │
│                                                    │
│ 💡 后续建议:                                       │
│                                                    │
│ 🔍 继续优化其他问题                                │
│   • 仍有2个失败用例待修复                         │
│   • 建议创建新的优化任务                          │
│   [创建新优化任务]                                │
│                                                    │
│ 📝 完善测试用例库                                  │
│   • 当前测试覆盖率: 72%                           │
│   • 建议补充边缘场景用例                          │
│   [管理测试用例]                                  │
│                                                    │
│ 📊 查看历史优化记录                                │
│   • 版本演进趋势                                  │
│   • 通过率变化曲线                                │
│   [查看优化历史]                                  │
│                                                    │
│ 🔔 设置监控告警                                    │
│   • 通过率下降告警                                │
│   • Badcase数量告警                               │
│   [配置告警规则]                                  │
│                                                    │
│ [返回首页] [开始新的优化]                          │
└──────────────────────────────────────────────────┘
```

**此时中间区域最终呈现:**

```
┌─────────────────────────────────────────────────┐
│ 提示词优化完成 - v2.4  🎉                          │
│                                                   │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                   │
│ 📋 优化摘要                                        │
│                                                   │
│ 优化模式: Badcase修复                             │
│ 问题案例: Badcase #0127 (密码歧义)                │
│ 优化策略: 调整规则顺序 + 增强词库 + 补充示例      │
│                                                   │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                   │
│ 📊 测试结果对比                                    │
│                                                   │
│ ┌───────────────────────────────────────────┐   │
│ │              v2.3      v2.4      变化      │   │
│ │ 通过率      66.7%     91.7%    +25.0% ✅  │   │
│ │ 修复数       -        6个       +6个 ✅    │   │
│ │ 回归数       -        0个       0个 ✅     │   │
│ └───────────────────────────────────────────┘   │
│                                                   │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                   │
│ 🔧 代码变更 (点击查看Diff)                        │
│                                                   │
│ • 修改位置: 第230-280行                           │
│ • 新增: 15行                                      │
│ • 删除: 3行                                       │
│ • 修改: 8行                                       │
│                                                   │
│ [查看完整Diff]                                    │
│                                                   │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                   │
│ 🚀 发布信息                                        │
│                                                   │
│ • 版本: v2.4                                      │
│ • 发布时间: 2025-01-16 14:38:22                   │
│ • 发布策略: 灰度(10%→100%)                        │
│ • 状态: ✅ 已发布                                  │
│                                                   │
│ [查看实时监控] [版本管理]                          │
└─────────────────────────────────────────────────┘
```

---

## 三、中间区域填充时序(仅在测试执行后填充)

### 完整时间轴(总耗时约 5-6分钟)

```
━━━ 用户点击"确认开始测试"前 ━━━
中间区域: 完全空白

━━━ 用户点击"确认开始测试"后 ━━━

【阶段1: 基准测试 - 0-120秒】
T+0s:   右侧显示"🧪 阶段1/3: 基准测试进行中..."
T+0-120s: 右侧实时显示测试进度和结果
         中间区域保持空白

T+120s: 基准测试完成
        右侧显示"✅ 阶段1/3: 基准测试完成"

T+121s: 中间区域开始填充基准测试结果
        • 标题栏 (1秒)
        • 测试概览卡片 (2秒)
        • 失败用例列表 (4秒)

【阶段2: 回归测试 - 120-243秒】
T+127s: 用户点击"继续回归测试"
        右侧显示"🧪 阶段2/3: 回归测试进行中..."

T+127-243s: 右侧实时显示测试进度
            中间区域保持当前内容

T+243s: 回归测试完成
        右侧显示"✅ 阶段2/3: 回归测试完成"

T+244s: 中间区域添加回归测试结果
        • 新版块标题 (1秒)
        • 测试概览卡片 (2秒)
        • 修复情况列表 (3秒)

【阶段3: 对比分析 - 243-250秒】
T+250s: 用户点击"开始对比分析"
        右侧显示思考动画

T+252s: 右侧显示完整对比报告

T+253s: 中间区域添加最终版块
        • 标题 (0.5秒)
        • 提示词Diff对比 (3秒)
        • 性能指标图表 (1秒)
        • 版本信息卡片 (1.5秒)

【完成】
T+258s: 所有内容填充完成
        等待用户发布决策
```

---

## 四、三种优化模式对比

### 模式对比表

| 模式 | 输入要求 | 核心能力 | 适用场景 |
|------|---------|---------|---------|
| **Badcase修复** | 选择具体失败案例 | 问题驱动,针对性修复 | 发现明确问题需要快速修复 |
| **智能诊断** | 选择诊断范围 + 配置诊断规则 | 主动发现潜在问题 | 系统性优化,预防性维护 |
| **需求优化** | 描述优化需求(10-500字) + 优化类型标签 | 功能增强或策略调整 | 新需求或业务变更 |

### 模式2: 智能诊断模式(简要说明)

**交互要点:**
```
用户选择"智能诊断模式"
→ 选择诊断范围:
  • 逻辑完整性
  • 安全风险
  • 性能优化
  • 最佳实践
→ AI自动扫描提示词
→ 生成诊断报告(潜在问题列表)
→ 用户选择要优化的问题
→ 进入测试流程(同模式1)
```

### 模式3: 需求优化模式(简要说明)

**交互要点:**
```
用户选择"需求优化模式"
→ 描述优化需求:
  "需要增加对重庆方言的支持,
   特别是'莫得'、'巴适'等词汇"
→ 选择优化类型:
  • 功能增强
  • 策略调整
  • 话术优化
→ AI理解需求并生成优化方案
→ 进入测试流程(同模式1)
```

---

## 五、数据预制清单

### AI需要预制的数据(用于模拟真实执行)

#### 1. Badcase数据库

```json
{
  "badcase_0127": {
    "id": "0127",
    "priority": "high",
    "type": "业务歧义识别失败",
    "time": "2025-01-14 10:23:15",
    "conversation": [
      {
        "role": "user",
        "content": "我要修改密码"
      },
      {
        "role": "assistant",
        "content": "{\"message\":\"小渝收到,马上为您跳转办理修改密码业务\",\"action\":\"VChangePassword\"}"
      },
      {
        "role": "user",
        "action": "clickBack",
        "feedback": "进入了错误的页面"
      }
    ],
    "expectedBehavior": {
      "message": "小渝了解您需要修改密码。我们提供:修改信用卡密码、修改信用卡查询密码,请问您需要修改哪一种密码？",
      "action": ""
    },
    "rootCause": "歧义检测规则位置错误,在Step1完整业务名检测之后",
    "impact": "用户体验差,进入错误页面",
    "relatedCases": ["0129", "0131", "0133"]
  }
}
```

#### 2. 测试用例库

```json
{
  "testSuite_password": {
    "name": "密码相关业务测试集",
    "totalCases": 24,
    "cases": [
      {
        "id": "TC_007",
        "input": "我要修改密码",
        "expectedAction": "",
        "expectedMessage": "小渝了解您需要修改密码。我们提供:修改信用卡密码、修改信用卡查询密码",
        "category": "歧义识别",
        "priority": "high"
      },
      {
        "id": "TC_011",
        "input": "修改信用卡密码",
        "expectedAction": "VChangePassword",
        "expectedMessage": "小渝收到,马上为您跳转办理修改信用卡密码业务",
        "category": "完整业务名",
        "priority": "high"
      },
      {
        "id": "TC_013",
        "input": "我想改个密码",
        "expectedAction": "",
        "expectedMessage": "需要列出密码选项",
        "category": "模糊表达",
        "priority": "medium"
      }
      // ... 其他21个用例
    ]
  }
}
```

#### 3. 诊断规则库

```json
{
  "diagnosticRules": [
    {
      "rule": "歧义检测位置",
      "check": "歧义检测是否在所有业务匹配之前执行",
      "severity": "high",
      "autoFix": true,
      "fixStrategy": "移动歧义检测规则到Step1之前"
    },
    {
      "rule": "示例完整性",
      "check": "每个业务类型是否都有示例对话",
      "severity": "medium",
      "autoFix": true,
      "fixStrategy": "自动生成缺失的示例"
    },
    {
      "rule": "性能优化",
      "check": "提示词长度是否超过最佳范围",
      "severity": "low",
      "autoFix": false,
      "fixStrategy": "建议压缩提示词"
    }
  ]
}
```

#### 4. 优化策略模板

```javascript
{
  fixBadcase: (badcase, prompt) => ({
    analysis: `根因分析: ${badcase.rootCause}`,
    strategy: [
      {
        name: "调整规则执行顺序",
        priority: "P0",
        difficulty: 2,
        impact: "complete",
        modifications: [
          {
            location: "line 230-280",
            action: "move",
            from: "Step1之后",
            to: "【上下文感知】之后,Step1之前"
          }
        ]
      }
    ],
    expectedResult: {
      fixedCases: 6,
      passRateImprovement: "+25%",
      regressionRisk: "low"
    }
  }),
  
  generateOptimizedPrompt: (originalPrompt, strategy) => {
    // 应用优化策略
    let optimized = originalPrompt;
    
    strategy.modifications.forEach(mod => {
      if (mod.action === "move") {
        // 执行移动操作
        optimized = moveSection(optimized, mod.from, mod.to);
      }
    });
    
    return optimized;
  }
}
```

#### 5. 版本对比数据

```json
{
  "versionComparison": {
    "v2.3": {
      "passRate": 0.667,
      "passed": 16,
      "failed": 8,
      "avgResponseTime": 1.2,
      "tokenUsage": 245
    },
    "v2.4": {
      "passRate": 0.917,
      "passed": 22,
      "failed": 2,
      "avgResponseTime": 1.3,
      "tokenUsage": 268
    },
    "improvements": {
      "passRate": "+25.0%",
      "fixedCases": 6,
      "newFailures": 0,
      "regressionCount": 0
    }
  }
}
```

---

## 六、验收标准

### 交互体验

- ✅ 6-7轮完成(模式选择+诊断+优化+测试准备+执行+分析+发布)
- ✅ 用户必须明确确认后才开始测试执行
- ✅ 中间区域在测试完成前保持空白
- ✅ 右侧实时显示测试进度和结果
- ✅ AI响应延迟符合真实场景(诊断3秒,优化2秒,测试2-4分钟)
- ✅ 测试过程可视化,进度清晰
- ✅ 支持测试暂停和取消

### 功能完整性

- ✅ 三种优化模式都可正常工作
- ✅ Badcase分析准确,根因定位清晰
- ✅ 优化方案合理,修复策略可行
- ✅ 基准测试和回归测试执行正常
- ✅ 版本对比数据准确,可视化清晰
- ✅ 支持灰度发布和紧急回滚

### 数据准确性

- ✅ 测试通过率计算正确
- ✅ Diff对比准确显示代码变更
- ✅ 修复情况统计完整
- ✅ 回归问题检测准确
- ✅ 性能指标对比真实

### 智能化程度

- ✅ 问题诊断准确率 > 90%
- ✅ 优化方案合理性 > 85%
- ✅ 自动修复成功率 > 80%
- ✅ 回归问题预测准确率 > 95%

### 用户控制感

- ✅ 用户在测试前可以调整配置
- ✅ 用户清楚知道测试会花费多长时间
- ✅ 用户可以实时查看测试进度
- ✅ 用户可以选择不同的发布策略
- ✅ 用户可以在发布后继续监控
- ✅ 所有自动优化的内容都有清晰标记

---

**文档版本:** v1.0  
**适用场景:** 场景C - 提示词优化(持续优化能力)  
**最后更新:** 2025-01-XX  
**维护者:** Huang
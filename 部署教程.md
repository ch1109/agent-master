# Agent Master æœåŠ¡å™¨éƒ¨ç½²æ•™ç¨‹

> ğŸ“– æœ¬æ•™ç¨‹å°†æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•å°† Agent Master é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨

---

## ğŸ“‹ ç›®å½•

1. [éƒ¨ç½²æ¦‚è§ˆ](#éƒ¨ç½²æ¦‚è§ˆ)
2. [é¦–æ¬¡éƒ¨ç½²å®Œæ•´æµç¨‹](#é¦–æ¬¡éƒ¨ç½²å®Œæ•´æµç¨‹)
3. [æ—¥å¸¸æ›´æ–°éƒ¨ç½²](#æ—¥å¸¸æ›´æ–°éƒ¨ç½²)
4. [æœåŠ¡ç®¡ç†](#æœåŠ¡ç®¡ç†)
5. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
6. [å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥](#å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥)

---

## éƒ¨ç½²æ¦‚è§ˆ

### æœåŠ¡å™¨ä¿¡æ¯

```
æœåŠ¡å™¨åœ°å€ï¼š192.168.100.62
ç”¨æˆ·åï¼šhywl
å¯†ç ï¼š123
ç³»ç»Ÿï¼šUbuntu
```

### éƒ¨ç½²æ¶æ„

```
æœ¬åœ°å¼€å‘ç¯å¢ƒ  â†’  æ„å»ºæ‰“åŒ…  â†’  ä¸Šä¼ æœåŠ¡å™¨  â†’  PM2å¯åŠ¨
     â†“              â†“            â†“             â†“
   æºä»£ç         dist.tgz    ç‰ˆæœ¬ç®¡ç†      è¿›ç¨‹å®ˆæŠ¤
```

### æŠ€æœ¯æ ˆ

- **PM2**ï¼šè¿›ç¨‹ç®¡ç†å™¨ï¼Œè´Ÿè´£å¯åŠ¨ã€é‡å¯ã€ç›‘æ§åº”ç”¨
- **serve**ï¼šé™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼Œæ‰˜ç®¡æ‰“åŒ…åçš„å‰ç«¯æ–‡ä»¶
- **éƒ¨ç½²ç«¯å£**ï¼š3000
- **è®¿é—®åœ°å€**ï¼šhttp://192.168.100.62:3000

---

## é¦–æ¬¡éƒ¨ç½²å®Œæ•´æµç¨‹

### æ­¥éª¤ 1ï¼šæœåŠ¡å™¨åˆå§‹åŒ–ï¼ˆä»…é¦–æ¬¡éœ€è¦ï¼‰

#### 1.1 ä¸Šä¼ åˆå§‹åŒ–è„šæœ¬

åœ¨**æœ¬åœ°ç»ˆç«¯**æ‰§è¡Œï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd "/Users/chch/Desktop/agent master"

# æ–¹å¼ä¸€ï¼šä½¿ç”¨ scp ä¸Šä¼ ï¼ˆéœ€è¦æ‰‹åŠ¨è¾“å…¥å¯†ç ï¼‰
scp scripts/server/setup.sh hywl@192.168.100.62:~/

# æ–¹å¼äºŒï¼šä½¿ç”¨ expect è‡ªåŠ¨è¾“å…¥å¯†ç 
expect << 'EOF'
spawn scp scripts/server/setup.sh hywl@192.168.100.62:~/
expect "password:"
send "123\r"
expect eof
EOF
```

**ğŸ’¡ æç¤º**ï¼š
- è¾“å…¥å¯†ç æ—¶ä¸ä¼šæ˜¾ç¤ºï¼Œè¿™æ˜¯æ­£å¸¸çš„
- çœ‹åˆ° `100%` è¡¨ç¤ºä¸Šä¼ æˆåŠŸ

#### 1.2 SSH è¿æ¥åˆ°æœåŠ¡å™¨

```bash
ssh hywl@192.168.100.62
# è¾“å…¥å¯†ç ï¼š123
```

#### 1.3 æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬

åœ¨**æœåŠ¡å™¨ä¸Š**æ‰§è¡Œï¼š

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x ~/setup.sh

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
./setup.sh
```

#### 1.4 åˆå§‹åŒ–è„šæœ¬åšäº†ä»€ä¹ˆï¼Ÿ

setup.sh ä¼šè‡ªåŠ¨å®Œæˆï¼š

1. âœ… æ£€æŸ¥ Node.js ç¯å¢ƒï¼ˆéœ€è¦ v16+ï¼‰
2. âœ… å…¨å±€å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
3. âœ… å…¨å±€å®‰è£… serveï¼ˆé™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼‰
4. âœ… åˆ›å»ºç›®å½•ç»“æ„ï¼š
   ```
   ~/apps/agent-master/
   â”œâ”€â”€ releases/     # ç‰ˆæœ¬ç›®å½•
   â”œâ”€â”€ logs/         # æ—¥å¿—ç›®å½•
   â”œâ”€â”€ backups/      # å¤‡ä»½ç›®å½•
   â””â”€â”€ config/       # é…ç½®ç›®å½•
   ```
5. âœ… ç”Ÿæˆ PM2 é…ç½®æ–‡ä»¶
6. âœ… é…ç½® PM2 å¼€æœºè‡ªå¯ï¼ˆå¯èƒ½éœ€è¦æ‰‹åŠ¨æ‰§è¡Œä¸€æ¡å‘½ä»¤ï¼‰

#### 1.5 é…ç½®å¼€æœºè‡ªå¯ï¼ˆå¦‚æœæç¤ºï¼‰

å¦‚æœ setup.sh è¾“å‡ºäº†ç±»ä¼¼è¿™æ ·çš„å‘½ä»¤ï¼š

```bash
sudo env PATH=$PATH:/path/to/node /path/to/pm2 startup systemd -u hywl --hp /home/hywl
```

è¯·å¤åˆ¶è¿™æ¡å‘½ä»¤å¹¶æ‰§è¡Œï¼Œç„¶åè¿è¡Œï¼š

```bash
pm2 save
```

#### 1.6 é€€å‡ºæœåŠ¡å™¨

```bash
exit
```

---

### æ­¥éª¤ 2ï¼šä¸€é”®éƒ¨ç½²

å›åˆ°**æœ¬åœ°ç»ˆç«¯**ï¼Œæ‰§è¡Œéƒ¨ç½²è„šæœ¬ï¼š

```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd "/Users/chch/Desktop/agent master"

# æ‰§è¡Œä¸€é”®éƒ¨ç½²
./scripts/deploy.sh
```

**å½“æç¤ºè¾“å…¥å¯†ç æ—¶**ï¼Œè¾“å…¥ï¼š`123`

#### 2.1 éƒ¨ç½²è„šæœ¬åšäº†ä»€ä¹ˆï¼Ÿ

deploy.sh ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ„å»ºé¡¹ç›®**
   ```
   â†’ æ¸…ç†æ—§çš„ dist ç›®å½•
   â†’ æ‰§è¡Œ npm run build
   â†’ åˆ›å»ºæ„å»ºä¿¡æ¯æ–‡ä»¶
   â†’ æ‰“åŒ…ä¸º dist.tgzï¼ˆçº¦ 2-5MBï¼‰
   ```

2. **éªŒè¯æœåŠ¡å™¨è¿æ¥**
   ```
   â†’ æµ‹è¯• SSH è¿æ¥
   â†’ æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯è¾¾
   ```

3. **ä¸Šä¼ æ–‡ä»¶**
   ```
   â†’ ä¸Šä¼  dist.tgz åˆ°æœåŠ¡å™¨
   â†’ æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
   ```

4. **æœåŠ¡å™¨ç«¯éƒ¨ç½²**
   ```
   â†’ åˆ›å»ºæ–°ç‰ˆæœ¬ç›®å½•ï¼ˆæ—¶é—´æˆ³å‘½åï¼‰
   â†’ è§£å‹æ–‡ä»¶
   â†’ å¤‡ä»½å½“å‰ç‰ˆæœ¬ï¼ˆå¦‚æœ‰ï¼‰
   â†’ åˆ‡æ¢è½¯é“¾æ¥åˆ°æ–°ç‰ˆæœ¬
   â†’ æ¸…ç†æ—§ç‰ˆæœ¬ï¼ˆä¿ç•™æœ€è¿‘ 3 ä¸ªï¼‰
   ```

5. **é‡å¯æœåŠ¡**
   ```
   â†’ é‡å¯ PM2 åº”ç”¨
   â†’ ä¿å­˜è¿›ç¨‹åˆ—è¡¨
   ```

6. **éªŒè¯éƒ¨ç½²**
   ```
   â†’ æ£€æŸ¥ PM2 è¿›ç¨‹çŠ¶æ€
   â†’ æ£€æŸ¥ HTTP å“åº”
   â†’ è®°å½•éƒ¨ç½²æ—¥å¿—
   ```

7. **æ˜¾ç¤ºç»“æœ**
   ```
   â†’ æ˜¾ç¤ºè®¿é—®åœ°å€
   â†’ æ˜¾ç¤ºæœåŠ¡ç®¡ç†å‘½ä»¤
   ```

#### 2.2 é¢„æœŸè¾“å‡º

æˆåŠŸéƒ¨ç½²åï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š

```
========================================
âœ“ éƒ¨ç½²æˆåŠŸï¼
========================================

éƒ¨ç½²ä¿¡æ¯ï¼š
  - ç‰ˆæœ¬: 20251209_183000
  - æœåŠ¡å™¨: hywl@192.168.100.62
  - ç«¯å£: 3000

è®¿é—®åœ°å€ï¼š
  http://192.168.100.62:3000

æœåŠ¡ç®¡ç†ï¼š
  æŸ¥çœ‹çŠ¶æ€: ssh hywl@192.168.100.62 'pm2 status agent-master'
  æŸ¥çœ‹æ—¥å¿—: ssh hywl@192.168.100.62 'pm2 logs agent-master'
  é‡å¯æœåŠ¡: ssh hywl@192.168.100.62 'pm2 restart agent-master'
```

---

### æ­¥éª¤ 3ï¼šéªŒè¯éƒ¨ç½²

#### 3.1 åœ¨æœåŠ¡å™¨ä¸ŠéªŒè¯

SSH è¿æ¥åˆ°æœåŠ¡å™¨ï¼š

```bash
ssh hywl@192.168.100.62
```

æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š

```bash
# æŸ¥çœ‹ PM2 è¿›ç¨‹çŠ¶æ€
pm2 status agent-master

# åº”è¯¥çœ‹åˆ°ï¼š
# â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ id  â”‚ name         â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚
# â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ 0   â”‚ agent-master â”‚ default     â”‚ N/A     â”‚ fork    â”‚ 1234     â”‚
# â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# Status: online  âœ“ æ­£å¸¸
# Status: errored âœ— å¼‚å¸¸

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep 3000
# æˆ–
ss -tlnp | grep 3000

# æµ‹è¯• HTTP å“åº”
curl -I http://localhost:3000
# åº”è¯¥è¿”å›ï¼šHTTP/1.1 200 OK
```

#### 3.2 åœ¨æœ¬åœ°æµè§ˆå™¨éªŒè¯

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š

```
http://192.168.100.62:3000
```

ä½ åº”è¯¥èƒ½çœ‹åˆ° Agent Master çš„ç•Œé¢ã€‚

---

## æ—¥å¸¸æ›´æ–°éƒ¨ç½²

å½“ä»£ç æœ‰æ›´æ–°æ—¶ï¼Œåªéœ€æ‰§è¡Œï¼š

```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•
./scripts/deploy.sh
```

**å°±è¿™ä¹ˆç®€å•ï¼** è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ„å»ºæœ€æ–°ä»£ç 
- ä¸Šä¼ åˆ°æœåŠ¡å™¨
- å¤‡ä»½æ—§ç‰ˆæœ¬
- åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬
- é‡å¯æœåŠ¡

### éƒ¨ç½²é€‰é¡¹

```bash
# è·³è¿‡æ„å»ºï¼Œç›´æ¥éƒ¨ç½²ç°æœ‰çš„ dist.tgz
./scripts/deploy.sh --skip-build

# ä¸å¤‡ä»½æ—§ç‰ˆæœ¬ï¼ˆä¸æ¨èï¼‰
./scripts/deploy.sh --no-backup

# æŒ‡å®šç«¯å£
./scripts/deploy.sh --port 8080
```

---

## æœåŠ¡ç®¡ç†

æ‰€æœ‰æœåŠ¡ç®¡ç†æ“ä½œéƒ½åœ¨**æœåŠ¡å™¨ä¸Š**æ‰§è¡Œã€‚

### è¿æ¥åˆ°æœåŠ¡å™¨

```bash
ssh hywl@192.168.100.62
# å¯†ç ï¼š123
```

### å¯åŠ¨æœåŠ¡

```bash
~/apps/agent-master/scripts/start.sh
```

æˆ–è€…ä½¿ç”¨ PM2 å‘½ä»¤ï¼š

```bash
pm2 start ~/apps/agent-master/config/ecosystem.config.js
pm2 save
```

### åœæ­¢æœåŠ¡

```bash
~/apps/agent-master/scripts/stop.sh
```

æˆ–ï¼š

```bash
pm2 stop agent-master
pm2 save
```

### é‡å¯æœåŠ¡

```bash
# æ™®é€šé‡å¯
~/apps/agent-master/scripts/restart.sh

# ç¡¬é‡å¯ï¼ˆå®Œå…¨åœæ­¢åé‡å¯ï¼‰
~/apps/agent-master/scripts/restart.sh --hard
```

æˆ–ï¼š

```bash
pm2 restart agent-master
```

### æŸ¥çœ‹çŠ¶æ€

```bash
# ä½¿ç”¨æˆ‘ä»¬çš„çŠ¶æ€è„šæœ¬ï¼ˆæ¨èï¼‰
~/apps/agent-master/scripts/status.sh

# æˆ–ç›´æ¥ä½¿ç”¨ PM2
pm2 status agent-master
pm2 monit  # å®æ—¶ç›‘æ§
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
~/apps/agent-master/scripts/logs.sh

# ä»…æŸ¥çœ‹é”™è¯¯æ—¥å¿—
~/apps/agent-master/scripts/logs.sh --error

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
~/apps/agent-master/scripts/logs.sh --lines 100

# æŸ¥çœ‹åç«‹å³é€€å‡ºï¼ˆä¸è·Ÿè¸ªï¼‰
~/apps/agent-master/scripts/logs.sh --no-follow
```

ä½¿ç”¨ PM2 æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
# å®æ—¶æ—¥å¿—
pm2 logs agent-master

# ä»…é”™è¯¯æ—¥å¿—
pm2 logs agent-master --err

# æ¸…ç©ºæ—¥å¿—
pm2 flush agent-master
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæœåŠ¡æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼šæµè§ˆå™¨æ— æ³•æ‰“å¼€ http://192.168.100.62:3000

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥ PM2 çŠ¶æ€
pm2 status agent-master
# å¦‚æœæ˜¾ç¤º "errored"ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—

# 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs agent-master --err --lines 50

# 3. æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep 3000
# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜æœåŠ¡æœªå¯åŠ¨

# 4. å°è¯•é‡å¯
pm2 restart agent-master

# 5. å¦‚æœè¿˜ä¸è¡Œï¼ŒæŸ¥çœ‹è¯¦ç»†çŠ¶æ€
pm2 describe agent-master
```

---

### é—®é¢˜ 2ï¼šPM2 è¿›ç¨‹é¢‘ç¹é‡å¯

**ç—‡çŠ¶**ï¼š`pm2 status` æ˜¾ç¤º restart æ¬¡æ•°å¾ˆé«˜

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs agent-master --err

# 2. æ£€æŸ¥å†…å­˜ä½¿ç”¨
pm2 monit
# å¦‚æœå†…å­˜è¶…è¿‡ 500MBï¼Œå¯èƒ½æ˜¯å†…å­˜æº¢å‡º

# 3. æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la ~/apps/agent-master/current/
# ç¡®ä¿æ–‡ä»¶å¯è¯»

# 4. æ£€æŸ¥ serve æ˜¯å¦æ­£å¸¸
which serve
serve --version
```

**è§£å†³æ–¹æ³•**ï¼š

```bash
# ç¡¬é‡å¯
pm2 delete agent-master
pm2 start ~/apps/agent-master/config/ecosystem.config.js
pm2 save
```

---

### é—®é¢˜ 3ï¼šé¡µé¢æ˜¾ç¤ºç©ºç™½

**ç—‡çŠ¶**ï¼šæµè§ˆå™¨æ‰“å¼€é¡µé¢æ˜¯ç©ºç™½çš„

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la ~/apps/agent-master/current/
# ç¡®ä¿æœ‰ index.html å’Œ assets/ ç›®å½•

# 2. æŸ¥çœ‹ index.html å†…å®¹
cat ~/apps/agent-master/current/index.html
# ç¡®ä¿å†…å®¹æ­£ç¡®

# 3. æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
du -sh ~/apps/agent-master/current/
# åº”è¯¥æœ‰ 30-40MB å·¦å³
```

**åœ¨æµè§ˆå™¨ä¸­**ï¼š

1. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
2. æŸ¥çœ‹ **Console** æ ‡ç­¾é¡µï¼Œçœ‹æ˜¯å¦æœ‰ JavaScript é”™è¯¯
3. æŸ¥çœ‹ **Network** æ ‡ç­¾é¡µï¼Œçœ‹æ˜¯å¦æœ‰èµ„æºåŠ è½½å¤±è´¥ï¼ˆçº¢è‰²ï¼‰

---

### é—®é¢˜ 4ï¼šéƒ¨ç½²è„šæœ¬è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼š`./scripts/deploy.sh` æç¤ºæ— æ³•è¿æ¥æœåŠ¡å™¨

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æµ‹è¯• SSH è¿æ¥
ssh hywl@192.168.100.62
# å¦‚æœè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œ

# 2. æ£€æŸ¥ç½‘ç»œ
ping 192.168.100.62
# å¦‚æœ ping ä¸é€šï¼Œæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿

# 3. æµ‹è¯• scp
echo "test" > /tmp/test.txt
scp /tmp/test.txt hywl@192.168.100.62:~/
# æµ‹è¯•æ–‡ä»¶ä¼ è¾“æ˜¯å¦æ­£å¸¸
```

---

## å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### æœ¬åœ°æ“ä½œ

```bash
# æ„å»ºé¡¹ç›®
./scripts/build.sh

# å®Œæ•´éƒ¨ç½²
./scripts/deploy.sh

# è·³è¿‡æ„å»ºéƒ¨ç½²
./scripts/deploy.sh --skip-build
```

### æœåŠ¡å™¨æ“ä½œ

```bash
# SSH è¿æ¥
ssh hywl@192.168.100.62

# æœåŠ¡ç®¡ç†
~/apps/agent-master/scripts/start.sh      # å¯åŠ¨
~/apps/agent-master/scripts/stop.sh       # åœæ­¢
~/apps/agent-master/scripts/restart.sh    # é‡å¯
~/apps/agent-master/scripts/status.sh     # çŠ¶æ€
~/apps/agent-master/scripts/logs.sh       # æ—¥å¿—

# PM2 å‘½ä»¤
pm2 start agent-master     # å¯åŠ¨
pm2 stop agent-master      # åœæ­¢
pm2 restart agent-master   # é‡å¯
pm2 status agent-master    # çŠ¶æ€
pm2 logs agent-master      # æ—¥å¿—
pm2 monit                  # å®æ—¶ç›‘æ§
pm2 describe agent-master  # è¯¦ç»†ä¿¡æ¯

# æ—¥å¿—æŸ¥çœ‹
tail -f ~/apps/agent-master/logs/access.log  # è®¿é—®æ—¥å¿—
tail -f ~/apps/agent-master/logs/error.log   # é”™è¯¯æ—¥å¿—
tail -f ~/apps/agent-master/logs/pm2.log     # PM2 æ—¥å¿—

# ç‰ˆæœ¬ç®¡ç†
~/apps/agent-master/scripts/backup.sh        # å¤‡ä»½å½“å‰ç‰ˆæœ¬
~/apps/agent-master/scripts/rollback.sh      # å›æ»šç‰ˆæœ¬
~/apps/agent-master/scripts/cleanup.sh       # æ¸…ç†æ—§æ–‡ä»¶
```

---

## é«˜çº§åŠŸèƒ½

### ç‰ˆæœ¬å›æ»š

å¦‚æœæ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

```bash
# SSH åˆ°æœåŠ¡å™¨
ssh hywl@192.168.100.62

# æ–¹å¼ä¸€ï¼šäº¤äº’å¼é€‰æ‹©ç‰ˆæœ¬
~/apps/agent-master/scripts/rollback.sh

# æ–¹å¼äºŒï¼šå›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
~/apps/agent-master/scripts/rollback.sh --last

# æ–¹å¼ä¸‰ï¼šå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
~/apps/agent-master/scripts/rollback.sh --version 20251209_180000
```

### æ‰‹åŠ¨å¤‡ä»½

åœ¨é‡è¦æ›´æ–°å‰æ‰‹åŠ¨å¤‡ä»½ï¼š

```bash
ssh hywl@192.168.100.62
~/apps/agent-master/scripts/backup.sh
```

### æ¸…ç†æ—§æ–‡ä»¶

å®šæœŸæ¸…ç†èŠ‚çœç£ç›˜ç©ºé—´ï¼š

```bash
ssh hywl@192.168.100.62
~/apps/agent-master/scripts/cleanup.sh
```

ä¼šæ¸…ç†ï¼š
- æ—§ç‰ˆæœ¬ï¼ˆä¿ç•™æœ€è¿‘ 3 ä¸ªï¼‰
- æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘ 5 ä¸ªï¼‰
- è¿‡æœŸæ—¥å¿—ï¼ˆä¿ç•™ 7 å¤©ï¼‰

### å¥åº·æ£€æŸ¥

è®¾ç½®å®šæ—¶å¥åº·æ£€æŸ¥ï¼š

```bash
ssh hywl@192.168.100.62

# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
*/5 * * * * /home/hywl/apps/agent-master/scripts/healthcheck.sh
```

å¥åº·æ£€æŸ¥ä¼šè‡ªåŠ¨ï¼š
- æ£€æŸ¥ PM2 è¿›ç¨‹çŠ¶æ€
- æ£€æŸ¥å†…å­˜ä½¿ç”¨
- æ£€æŸ¥ HTTP å“åº”
- æ£€æŸ¥ç£ç›˜ç©ºé—´
- å‡ºç°å¼‚å¸¸æ—¶å°è¯•è‡ªåŠ¨é‡å¯

---

## è¿ç»´æœ€ä½³å®è·µ

### 1. å®šæœŸå¤‡ä»½

é‡è¦æ›´æ–°å‰å¤‡ä»½ï¼š

```bash
ssh hywl@192.168.100.62
~/apps/agent-master/scripts/backup.sh
```

### 2. å®šæœŸæ¸…ç†

æ¯å‘¨æ¸…ç†ä¸€æ¬¡ï¼š

```bash
ssh hywl@192.168.100.62
~/apps/agent-master/scripts/cleanup.sh
```

### 3. ç›‘æ§æ—¥å¿—å¤§å°

å®šæœŸæ£€æŸ¥ï¼š

```bash
ssh hywl@192.168.100.62
du -sh ~/apps/agent-master/logs/
```

### 4. é…ç½®æ—¥å¿—è½®è½¬

ä½¿ç”¨ PM2 æ—¥å¿—è½®è½¬æ¨¡å—ï¼š

```bash
ssh hywl@192.168.100.62

pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true
```

### 5. éªŒè¯æ¯æ¬¡éƒ¨ç½²

éƒ¨ç½²åéªŒè¯ï¼š

```bash
# æ£€æŸ¥çŠ¶æ€
ssh hywl@192.168.100.62 '~/apps/agent-master/scripts/status.sh'

# æµè§ˆå™¨æµ‹è¯•
open http://192.168.100.62:3000
```

---

## æ€»ç»“

### é¦–æ¬¡éƒ¨ç½²ä¸‰æ­¥èµ°

1. **åˆå§‹åŒ–æœåŠ¡å™¨**ï¼ˆä»…ä¸€æ¬¡ï¼‰
   ```bash
   scp scripts/server/setup.sh hywl@192.168.100.62:~/
   ssh hywl@192.168.100.62
   chmod +x ~/setup.sh && ./setup.sh
   exit
   ```

2. **æ‰§è¡Œéƒ¨ç½²**
   ```bash
   ./scripts/deploy.sh
   ```

3. **æµè§ˆå™¨è®¿é—®**
   ```
   http://192.168.100.62:3000
   ```

### æ—¥å¸¸æ›´æ–°ä¸€é”®æå®š

```bash
./scripts/deploy.sh
```

### é‡åˆ°é—®é¢˜ä¸è¦æ…Œ

1. æŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs agent-master`
2. æ£€æŸ¥çŠ¶æ€ï¼š`pm2 status agent-master`
3. å°è¯•é‡å¯ï¼š`pm2 restart agent-master`
4. å®åœ¨ä¸è¡Œï¼šå›æ»šç‰ˆæœ¬

---

## è·å–å¸®åŠ©

- **è„šæœ¬ä½¿ç”¨è¯´æ˜**ï¼šæŸ¥çœ‹ [scripts/README.md](scripts/README.md)
- **PM2 æ–‡æ¡£**ï¼šhttps://pm2.keymetrics.io/
- **æœåŠ¡å™¨æ—¥å¿—**ï¼š`~/apps/agent-master/logs/`

---

**ğŸ‰ æ­å–œï¼ä½ å·²ç»æŒæ¡äº† Agent Master çš„éƒ¨ç½²æ–¹æ³•ï¼**
